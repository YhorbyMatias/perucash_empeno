<!DOCTYPE html>
<html lang="es">
<head>
	<title>Adminitración de préstamos y empeños - PerúCash</title>
	<meta charset="UTF-8">

	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="shortcut icon" href="images/favicon.png">
	<link rel="stylesheet" type="text/css" href="css/bootstrap-datepicker3.css">
	<link rel="stylesheet" type="text/css" href="css/anatsunamun.css">
	<link rel="stylesheet" type="text/css" href="css/icofont.css">
</head>
<body>


<div class="container formulario">
<div class="text-center">
<img src="images/logo.png">
<h3>Perú Cash $<small> Sistema de préstamos y empeños</small></h3></div>

<div class="panel with-nav-tabs panel-warning">
	<div class="panel-heading">
		<ul class="nav nav-tabs">
		    <li class="active"><a href="#tabRegistro" data-toggle="tab">Registro</a></li>
		    <li><a href="#tabBusqueda" data-toggle="tab">Búsqueda</a></li>
		    <li><a href="#tabDetalle" data-toggle="tab">Detalle</a></li>
		  </ul>
	</div>
	<div class="panel-body">
		 <div class="tab-content container-fluid">
  	<div class="tab-pane fade in active" id="tabRegistro">
  	
	<div class="row well">
		<p><strong>Datos de cliente:</strong></p>
		<div class="col-sm-6"><label>Apellidos:</label><input type="text" class="form-control mayuscula" id="txtApellidos" placeholder="Apellidos completos"></div>
		<div class="col-sm-6"><label>Nombres:</label><input type="text" class="form-control mayuscula" id="txtNombres" placeholder="Nombres completos"></div>
		<div class="col-sm-6"><label>D.N.I.:</label><input type="text" class="form-control" id="txtDni" placeholder="Número del documento de identidad"></div>
		<div class="col-sm-6"><label>Dirección domiciliaria:</label><input type="text" class="form-control mayuscula" id="txtDireccion" placeholder="Dirección del cliente"></div>
		<div class="col-sm-6"><label>Correo electrónico:</label><input type="text" class="form-control" id="txtCorreo" placeholder="Correo electrónico del cliente"></div>
		<div class="col-sm-6"><label>Celular:</label><input type="text" class="form-control" id="txtCelular" placeholder="Número de celular(es)"></div>
	</div>

	<div class="row well well-amarillo">
		<p><strong>Datos del bien que ingresa:</strong></p>
		<label>Objeto que se ingresa:</label> <input type="text" class="form-control mayuscula" id="txtNombreProducto" placeholder="Detalle el nombre y características del objeto.">
		<div class="col-sm-6"><label>Monto entregado (S/.):</label> <input type="number" id="txtMontoEntregado" class="form-control" placeholder="Monto S/." min ="0" step="1"></div>
		<div class="col-sm-6"><label>Interés (%):</label> <input type="number" id="txtMontoInteres" class="form-control" placeholder="% de Interés" value="4" min ="0" step="1"></div>
		<div class="col-sm-6"><label>Fecha de ingreso:</label> <div class="sandbox-container"><input  id="dtpFechaInicio" type="text" class="form-control"></div></div>
		<div class="col-sm-6"><label>Vencimiento:</label> <div class="sandbox-container"><input  id="dtpFechaVencimiento" type="text" class="form-control"></div></div>
		<div class="col-sm-6"><label>Observaciones o datos extras:</label> <textarea  class="form-control mayuscula" id="txtObservaciones" rows="2" placeholder="¿Alguna observación o dato extra que desees recordar luego?"></textarea></div>
		<div class="col-sm-6"><label>Calculado:</label> <p>Periodo: <span id="spanPeriodo">1 día</span></p> <p>Intereses: <span id="spanInteres">S/. 0.00</span></p> <p>Monto total a pagar: S/.  <span id="spanMonto">0.00</span></p></div>
		<br>

	</div>
	<hr>
	<div class="pull-left"><button class="btn btn-success" id="btnLimpiarDatos"><i class="icofont icofont-eraser"></i> Limpiar datos</button></div>
	<div class="text-center"><button class="btn btn-primary" id="btnGuardarDatos"><i class="icofont icofont-diskette"></i> Guardar datos</button></div>
    <div class="pull-right">User actual: <em>Carlos Pariona Valencia</em></div>
    <!-- fin de tab pane 1 -->
    </div>
  	<div class="tab-pane fade  " id="tabBusqueda">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
  	tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
  	quis nostrud exercitation ullamco laboris nisi ut aliquimmodo
  	consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
  	cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
  	proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
  	<div class="tab-pane fade  " id="tabDetalle">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
  	tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
  	quis nostrud exercitation ullamco laboris nisi ut aliqucupidatat non
  	proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>

  </div>
	</div>
</div>



 <!-- Modal para indicar que se guardó con éxito -->
	<div class="modal fade modal-ventaGuardada" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content">
			<div class="modal-header-primary">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel"><i class="icofont icofont-help-robot"></i> Adquisición guardada</h4>
			</div>
			<div class="modal-body">
				<strong><i class="icofont icofont-social-smugmug"></i> Enhorabuena,</strong> sus datos fueron guardados correctamente.
			</div>
			<div class="modal-footer"> 
			<button class="btn btn-primary btn-outline" data-dismiss="modal"><i class="icofont icofont-check"></i> Ok, aceptar</button></div>
		</div>
		</div>
	</div>
	
</div>
<!-- Modal para indicar que falta completar campos o datos con error -->
<div class="modal fade modal-faltaCompletar" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
<div class="modal-dialog modal-sm" role="document">
	<div class="modal-content">
		<div class="modal-header-danger">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel"><i class="icofont icofont-animal-cat-alt-4"></i> Campos incorrectos o faltantes</h4>
		</div>
		<div class="modal-body">
			Ups, un error: <i class="icofont icofont-animal-squirrel"></i> <em id="lblFalta"></em>
		</div>
		<div class="modal-footer"> 
		
		<button class="btn btn-danger btn-outline" data-dismiss="modal"><i class="icofont icofont-alarm"></i> Ok, revisaré</button>
		</div>
	</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="js/bootstrap-datepicker.es.min.js"></script>
<script type="text/javascript" src="js/moment.js"></script>
<script type="text/javascript" src="js/impotem.js"></script>
<script>
$.(document).ready(function () {
	$('#dtpFechaInicio').val(moment().format('DD/MM/YYYY'));
	$('#dtpFechaVencimiento').val(moment().add(1, 'days').format('DD/MM/YYYY'));
	var idNew = 
})


$('.sandbox-container input').datepicker({language: "es", autoclose: true, todayBtn: "linked"});

$('#dtpFechaInicio').change(function () {
	calcularPeriodo();
});
$('#dtpFechaVencimiento').change(function () {
	calcularPeriodo();
});
function calcularPeriodo(){

	var fechaAnterior, fechaVencimiento, diferenciaDias , diferenciaSemanas, diferenciaRestoDias, montoDado, montoInteres, montoaPagar;

	if($('#dtpFechaInicio').val()!='' && $('#dtpFechaVencimiento').val()!='' ){
		fechaAnterior = moment( $('#dtpFechaInicio').val(),'DD/MM/YYYY');
		fechaVencimiento= moment( $('#dtpFechaVencimiento').val(),'DD/MM/YYYY');
		diferenciaDias = fechaVencimiento.diff(fechaAnterior, 'days');

		
		if(diferenciaDias<=0){$('#lblFalta').text('La fecha de vencimiento no puede ser mejor o igual a la fecha de ingreso.')
			$('.modal-faltaCompletar').modal('show');montoDado =0;diferenciaSemanas=0;
		  }
		else{
			if(diferenciaDias<=6){diferenciaSemanas=0;diferenciaRestoDias=1; $('#spanPeriodo').text(diferenciaDias + ' días'); }
			else{diferenciaSemanas =  parseInt(diferenciaDias/7); diferenciaRestoDias= diferenciaDias%7; $('#spanPeriodo').text(diferenciaSemanas + ' semanas y ' +diferenciaRestoDias + ' días') }
		}
		if($('#txtMontoEntregado').val()==''){montoDado =0; } else{montoDado= parseFloat($('#txtMontoEntregado').val());}
		if($('#txtMontoInteres').val()==''){montoInteres =0; }else{montoInteres = parseFloat($('#txtMontoInteres').val()/100);}
		
		

		if(diferenciaRestoDias>0 ){
			diferenciaSemanas+=1
			//console.log('semana de impuesto: ' + parseInt(diferenciaSemanas+1) + ' Monto a pagar')
		}

		montoaPagar = montoDado+(montoDado*montoInteres)*(diferenciaSemanas);
		/*console.log('semana de impuesto: ' + parseInt(diferenciaSemanas))
		console.log('dado: '+montoDado+' interes '+montoInteres+' semana: '+ parseInt(diferenciaSemanas))
		console.log('a pagar ' + montoaPagar);*/
		$('#spanInteres').text('S/. '+ parseFloat(montoDado*montoInteres* diferenciaSemanas).toFixed(2))
		$('#spanMonto').text(montoaPagar.toFixed(2))
		
	}
	else{
		$('#spanPeriodo').text('Fecha inválida');
	}
}
$('#btnGuardarDatos').click(function () {
	calcularPeriodo();
	if(verificarTodoRellenado()){
		$.ajax({url: 'php/insertarProducto.php', type: 'POST', data:{
		nombre: $('#txtNombres').val(),
		apellido: $('#txtApellidos').val(),
		direccion: $('#txtDireccion').val(),
		dni: $('#txtDni').val(),
		email:  $('#txtCorreo').val(),
		celular: $('#txtCelular').val(),
		productoNombre: $('#txtNombreProducto').val(),
		montoentregado: $('#txtMontoEntregado').val(),
		interes: $('#txtMontoInteres').val(),
		montopagar: $('#spanMonto').text(),
		fechainicial: moment($('#dtpFechaInicio').val(), 'DD/MM/YYYY').format('YYYY-MM-DD'),
		feachavencimiento: moment($('#dtpFechaVencimiento').val(), 'DD/MM/YYYY').format('YYYY-MM-DD'),
		observaciones: $('#txtObservaciones').val()
		}
	}).done(function (resp) {// console.log(resp) 
		if(resp==1){ $('.modal-ventaGuardada').modal('show'); limpiarCasillas();}
	});
	}//<- fin de if
	
});
$('#btnLimpiarDatos').click(function () {
	limpiarCasillas();
})
function limpiarCasillas(){
	$('#tabRegistro input[type="text"]').val('');
	$('#dtpFechaInicio').val(moment().format('DD/MM/YYYY'));
	$('#dtpFechaVencimiento').val(moment().add(1, 'days').format('DD/MM/YYYY'));
	
	$('#txtMontoEntregado').val('0.00');
	$('#txtMontoInteres').val('4');
	$('#txtObservaciones').val('');
}
function verificarTodoRellenado(){
	var estado = false;
	if ( $('#txtApellidos').val()=='' ||  $('#txtNombres').val()=='' ||   $('#txtDni').val()=='' ||  $('#txtDireccion').val()=='' ||  $('#txtCelular').val()=='' ){
		$('#lblFalta').text('Falta ingresar algunos datos importantes del Cliente, por favor revíselos'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else if($('#txtNombreProducto').val()==''){$('#lblFalta').text('Estas olvidando poner un nombre al producto que se adquiere'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else if($('#txtMontoEntregado').val()=='' || $('#txtMontoEntregado').val()<=0 ){$('#lblFalta').text('Estas olvidando poner el monto entregado al producto que se adquiere'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else if($('#txtMontoInteres').val()=='' ||$('#txtMontoInteres').val()<=0 ){$('#lblFalta').text('Estas olvidando poner el interés semanal al producto que se adquiere'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else if($('#dtpFechaInicio').val()=='' ){$('#lblFalta').text('Estas olvidando poner poner una fecha inicial al producto que se adquiere'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else if($('#dtpFechaVencimiento').val()=='' || $('#dtpFechaInicio').val()==$('#dtpFechaVencimiento').val() ){$('#lblFalta').text('Hay un problema con la fecha final, no puede ser igual o menor a la fecha inicial'); $('.modal-faltaCompletar').modal('show'); estado= false;}
	else{ estado = true;}
	return estado;
}
$('a[data-toggle="tab"]').on('shown.bs.tab', function (e){
	 var target = $(e.target).attr("href") // activated tab
	 if(target=='#tabBusqueda'){
	  rellenarTabBusqueda();
	 }
});
function rellenarTabBusqueda(){

}
</script>
</body>
</html>